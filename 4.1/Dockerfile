FROM alpine:3.6

ENV VARNISH_BACKEND_HOST nginx
ENV VARNISH_BACKEND_PORT 80
ENV VARNISH_MEMORY 100M
ENV VARNISH_BACKEND_FIRST_BYTE_TIMEOUT 300s
ENV VARNISH_BACKEND_CONNECT_TIMEOUT 5s
ENV VARNISH_BACKEND_BETWEEN_BYTES_TIMEOUT 2s
ENV VARNISH_ERRORS_TTL 10m
ENV VARNISH_GRACE 6h
ENV VARNISH_SUBNET 172.16.0.0/12

RUN apk add --no-cache varnish

EXPOSE 80
ADD start.sh /start.sh
ADD default.vcl /etc/varnish/default.vcl
CMD ["/start.sh"]